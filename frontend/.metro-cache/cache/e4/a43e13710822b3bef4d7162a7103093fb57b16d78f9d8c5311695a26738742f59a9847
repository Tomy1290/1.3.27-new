{"dependencies":[{"name":"../utils/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":40,"index":40}}],"key":"XoJ+jbKCrEi38eKczMqtlbk+TCk=","exportNames":["*"]}},{"name":"./localChat","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":41},"end":{"line":2,"column":56,"index":97}}],"key":"aXvKl/lmPsjnZryl5znHfKnmrlU=","exportNames":["*"]}},{"name":"./summary","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":98},"end":{"line":3,"column":45,"index":143}}],"key":"3AleHoplC8CAd676xho2Y/OsXUw=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.callCloudLLM = callCloudLLM;\n  exports.getAIStatus = getAIStatus;\n  exports.hybridGreeting = hybridGreeting;\n  exports.hybridReply = hybridReply;\n  exports.testCloudConnection = testCloudConnection;\n  var _api = require(_dependencyMap[0], \"../utils/api\");\n  var _localChat = require(_dependencyMap[1], \"./localChat\");\n  var _summary = require(_dependencyMap[2], \"./summary\");\n  /**\n   * Test if Cloud LLM is reachable by doing a simple health check\n   */\n  async function testCloudConnection() {\n    try {\n      const response = await (0, _api.apiFetch)('/', {\n        method: 'GET',\n        signal: AbortSignal.timeout(3000) // 3 second timeout\n      });\n      return response.ok;\n    } catch (error) {\n      console.warn('Cloud LLM connection test failed:', error);\n      return false;\n    }\n  }\n\n  /**\n   * Call Cloud LLM with timeout and error handling\n   */\n  async function callCloudLLM(request) {\n    try {\n      const response = await (0, _api.apiFetch)('/chat', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(request),\n        signal: AbortSignal.timeout(8000) // 8 second timeout\n      });\n      if (!response.ok) {\n        throw new Error(`Cloud LLM responded with status ${response.status}`);\n      }\n      const data = await response.json();\n      return data.text || '';\n    } catch (error) {\n      console.warn('Cloud LLM call failed:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Hybrid greeting - tries Cloud LLM first, falls back to local\n   */\n  async function hybridGreeting(state) {\n    try {\n      // Test connection first\n      const isConnected = await testCloudConnection();\n      if (!isConnected) {\n        throw new Error('Cloud LLM not reachable');\n      }\n\n      // Prepare summary for Cloud LLM\n      const summary = (0, _summary.computeAISummary)(state);\n      const request = {\n        mode: 'greeting',\n        language: state.language || 'de',\n        model: 'gpt-4o-mini',\n        summary\n      };\n      const result = await callCloudLLM(request);\n      if (result && result.trim()) {\n        console.log('âœ… Cloud LLM greeting successful');\n        return result.trim();\n      }\n      throw new Error('Empty response from Cloud LLM');\n    } catch (error) {\n      console.log('ðŸ”„ Cloud LLM failed, falling back to local greeting:', error);\n      return await (0, _localChat.localGreeting)(state);\n    }\n  }\n\n  /**\n   * Hybrid reply - tries Cloud LLM first, falls back to local\n   */\n  async function hybridReply(state, userMessage) {\n    try {\n      // Test connection first\n      const isConnected = await testCloudConnection();\n      if (!isConnected) {\n        throw new Error('Cloud LLM not reachable');\n      }\n\n      // Prepare summary for Cloud LLM\n      const summary = (0, _summary.computeAISummary)(state);\n\n      // Get recent chat history for context\n      const recentChat = (state.chat || []).slice(-6).map(msg => ({\n        role: msg.sender === 'user' ? 'user' : 'assistant',\n        content: msg.text\n      }));\n\n      // Add current user message\n      recentChat.push({\n        role: 'user',\n        content: userMessage\n      });\n      const request = {\n        mode: 'chat',\n        language: state.language || 'de',\n        model: 'gpt-4o-mini',\n        summary,\n        messages: recentChat\n      };\n      const result = await callCloudLLM(request);\n      if (result && result.trim()) {\n        console.log('âœ… Cloud LLM reply successful');\n        return result.trim();\n      }\n      throw new Error('Empty response from Cloud LLM');\n    } catch (error) {\n      console.log('ðŸ”„ Cloud LLM failed, falling back to local reply:', error);\n      return await (0, _localChat.localReply)(state, userMessage);\n    }\n  }\n\n  /**\n   * Get current AI status for UI indication\n   */\n  async function getAIStatus() {\n    try {\n      const isConnected = await testCloudConnection();\n      return isConnected ? 'cloud' : 'local';\n    } catch (error) {\n      return 'local';\n    }\n  }\n});","lineCount":139,"map":[[10,2,1,0],[10,6,1,0,"_api"],[10,10,1,0],[10,13,1,0,"require"],[10,20,1,0],[10,21,1,0,"_dependencyMap"],[10,35,1,0],[11,2,2,0],[11,6,2,0,"_localChat"],[11,16,2,0],[11,19,2,0,"require"],[11,26,2,0],[11,27,2,0,"_dependencyMap"],[11,41,2,0],[12,2,3,0],[12,6,3,0,"_summary"],[12,14,3,0],[12,17,3,0,"require"],[12,24,3,0],[12,25,3,0,"_dependencyMap"],[12,39,3,0],[13,2,17,0],[14,0,18,0],[15,0,19,0],[16,2,20,7],[16,17,20,22,"testCloudConnection"],[16,36,20,41,"testCloudConnection"],[16,37,20,41],[16,39,20,62],[17,4,21,2],[17,8,21,6],[18,6,22,4],[18,12,22,10,"response"],[18,20,22,18],[18,23,22,21],[18,29,22,27],[18,33,22,27,"apiFetch"],[18,46,22,35],[18,48,22,36],[18,51,22,39],[18,53,22,41],[19,8,23,6,"method"],[19,14,23,12],[19,16,23,14],[19,21,23,19],[20,8,24,6,"signal"],[20,14,24,12],[20,16,24,14,"AbortSignal"],[20,27,24,25],[20,28,24,26,"timeout"],[20,35,24,33],[20,36,24,34],[20,40,24,38],[20,41,24,39],[20,42,24,40],[21,6,25,4],[21,7,25,5],[21,8,25,6],[22,6,26,4],[22,13,26,11,"response"],[22,21,26,19],[22,22,26,20,"ok"],[22,24,26,22],[23,4,27,2],[23,5,27,3],[23,6,27,4],[23,13,27,11,"error"],[23,18,27,16],[23,20,27,18],[24,6,28,4,"console"],[24,13,28,11],[24,14,28,12,"warn"],[24,18,28,16],[24,19,28,17],[24,54,28,52],[24,56,28,54,"error"],[24,61,28,59],[24,62,28,60],[25,6,29,4],[25,13,29,11],[25,18,29,16],[26,4,30,2],[27,2,31,0],[29,2,33,0],[30,0,34,0],[31,0,35,0],[32,2,36,7],[32,17,36,22,"callCloudLLM"],[32,29,36,34,"callCloudLLM"],[32,30,36,35,"request"],[32,37,36,60],[32,39,36,79],[33,4,37,2],[33,8,37,6],[34,6,38,4],[34,12,38,10,"response"],[34,20,38,18],[34,23,38,21],[34,29,38,27],[34,33,38,27,"apiFetch"],[34,46,38,35],[34,48,38,36],[34,55,38,43],[34,57,38,45],[35,8,39,6,"method"],[35,14,39,12],[35,16,39,14],[35,22,39,20],[36,8,40,6,"headers"],[36,15,40,13],[36,17,40,15],[37,10,41,8],[37,24,41,22],[37,26,41,24],[38,8,42,6],[38,9,42,7],[39,8,43,6,"body"],[39,12,43,10],[39,14,43,12,"JSON"],[39,18,43,16],[39,19,43,17,"stringify"],[39,28,43,26],[39,29,43,27,"request"],[39,36,43,34],[39,37,43,35],[40,8,44,6,"signal"],[40,14,44,12],[40,16,44,14,"AbortSignal"],[40,27,44,25],[40,28,44,26,"timeout"],[40,35,44,33],[40,36,44,34],[40,40,44,38],[40,41,44,39],[40,42,44,40],[41,6,45,4],[41,7,45,5],[41,8,45,6],[42,6,47,4],[42,10,47,8],[42,11,47,9,"response"],[42,19,47,17],[42,20,47,18,"ok"],[42,22,47,20],[42,24,47,22],[43,8,48,6],[43,14,48,12],[43,18,48,16,"Error"],[43,23,48,21],[43,24,48,22],[43,59,48,57,"response"],[43,67,48,65],[43,68,48,66,"status"],[43,74,48,72],[43,76,48,74],[43,77,48,75],[44,6,49,4],[45,6,51,4],[45,12,51,10,"data"],[45,16,51,33],[45,19,51,36],[45,25,51,42,"response"],[45,33,51,50],[45,34,51,51,"json"],[45,38,51,55],[45,39,51,56],[45,40,51,57],[46,6,52,4],[46,13,52,11,"data"],[46,17,52,15],[46,18,52,16,"text"],[46,22,52,20],[46,26,52,24],[46,28,52,26],[47,4,53,2],[47,5,53,3],[47,6,53,4],[47,13,53,11,"error"],[47,18,53,16],[47,20,53,18],[48,6,54,4,"console"],[48,13,54,11],[48,14,54,12,"warn"],[48,18,54,16],[48,19,54,17],[48,43,54,41],[48,45,54,43,"error"],[48,50,54,48],[48,51,54,49],[49,6,55,4],[49,12,55,10,"error"],[49,17,55,15],[50,4,56,2],[51,2,57,0],[53,2,59,0],[54,0,60,0],[55,0,61,0],[56,2,62,7],[56,17,62,22,"hybridGreeting"],[56,31,62,36,"hybridGreeting"],[56,32,62,37,"state"],[56,37,62,47],[56,39,62,66],[57,4,63,2],[57,8,63,6],[58,6,64,4],[59,6,65,4],[59,12,65,10,"isConnected"],[59,23,65,21],[59,26,65,24],[59,32,65,30,"testCloudConnection"],[59,51,65,49],[59,52,65,50],[59,53,65,51],[60,6,66,4],[60,10,66,8],[60,11,66,9,"isConnected"],[60,22,66,20],[60,24,66,22],[61,8,67,6],[61,14,67,12],[61,18,67,16,"Error"],[61,23,67,21],[61,24,67,22],[61,49,67,47],[61,50,67,48],[62,6,68,4],[64,6,70,4],[65,6,71,4],[65,12,71,10,"summary"],[65,19,71,17],[65,22,71,20],[65,26,71,20,"computeAISummary"],[65,51,71,36],[65,53,71,37,"state"],[65,58,71,42],[65,59,71,43],[66,6,73,4],[66,12,73,10,"request"],[66,19,73,35],[66,22,73,38],[67,8,74,6,"mode"],[67,12,74,10],[67,14,74,12],[67,24,74,22],[68,8,75,6,"language"],[68,16,75,14],[68,18,75,16,"state"],[68,23,75,21],[68,24,75,22,"language"],[68,32,75,30],[68,36,75,34],[68,40,75,38],[69,8,76,6,"model"],[69,13,76,11],[69,15,76,13],[69,28,76,26],[70,8,77,6,"summary"],[71,6,78,4],[71,7,78,5],[72,6,80,4],[72,12,80,10,"result"],[72,18,80,16],[72,21,80,19],[72,27,80,25,"callCloudLLM"],[72,39,80,37],[72,40,80,38,"request"],[72,47,80,45],[72,48,80,46],[73,6,81,4],[73,10,81,8,"result"],[73,16,81,14],[73,20,81,18,"result"],[73,26,81,24],[73,27,81,25,"trim"],[73,31,81,29],[73,32,81,30],[73,33,81,31],[73,35,81,33],[74,8,82,6,"console"],[74,15,82,13],[74,16,82,14,"log"],[74,19,82,17],[74,20,82,18],[74,53,82,51],[74,54,82,52],[75,8,83,6],[75,15,83,13,"result"],[75,21,83,19],[75,22,83,20,"trim"],[75,26,83,24],[75,27,83,25],[75,28,83,26],[76,6,84,4],[77,6,86,4],[77,12,86,10],[77,16,86,14,"Error"],[77,21,86,19],[77,22,86,20],[77,53,86,51],[77,54,86,52],[78,4,87,2],[78,5,87,3],[78,6,87,4],[78,13,87,11,"error"],[78,18,87,16],[78,20,87,18],[79,6,88,4,"console"],[79,13,88,11],[79,14,88,12,"log"],[79,17,88,15],[79,18,88,16],[79,72,88,70],[79,74,88,72,"error"],[79,79,88,77],[79,80,88,78],[80,6,89,4],[80,13,89,11],[80,19,89,17],[80,23,89,17,"localGreeting"],[80,47,89,30],[80,49,89,31,"state"],[80,54,89,36],[80,55,89,37],[81,4,90,2],[82,2,91,0],[84,2,93,0],[85,0,94,0],[86,0,95,0],[87,2,96,7],[87,17,96,22,"hybridReply"],[87,28,96,33,"hybridReply"],[87,29,96,34,"state"],[87,34,96,44],[87,36,96,46,"userMessage"],[87,47,96,65],[87,49,96,84],[88,4,97,2],[88,8,97,6],[89,6,98,4],[90,6,99,4],[90,12,99,10,"isConnected"],[90,23,99,21],[90,26,99,24],[90,32,99,30,"testCloudConnection"],[90,51,99,49],[90,52,99,50],[90,53,99,51],[91,6,100,4],[91,10,100,8],[91,11,100,9,"isConnected"],[91,22,100,20],[91,24,100,22],[92,8,101,6],[92,14,101,12],[92,18,101,16,"Error"],[92,23,101,21],[92,24,101,22],[92,49,101,47],[92,50,101,48],[93,6,102,4],[95,6,104,4],[96,6,105,4],[96,12,105,10,"summary"],[96,19,105,17],[96,22,105,20],[96,26,105,20,"computeAISummary"],[96,51,105,36],[96,53,105,37,"state"],[96,58,105,42],[96,59,105,43],[98,6,107,4],[99,6,108,4],[99,12,108,10,"recentChat"],[99,22,108,20],[99,25,108,23],[99,26,108,24,"state"],[99,31,108,29],[99,32,108,30,"chat"],[99,36,108,34],[99,40,108,38],[99,42,108,40],[99,44,108,42,"slice"],[99,49,108,47],[99,50,108,48],[99,51,108,49],[99,52,108,50],[99,53,108,51],[99,54,108,52,"map"],[99,57,108,55],[99,58,108,57,"msg"],[99,61,108,65],[99,66,108,71],[100,8,109,6,"role"],[100,12,109,10],[100,14,109,12,"msg"],[100,17,109,15],[100,18,109,16,"sender"],[100,24,109,22],[100,29,109,27],[100,35,109,33],[100,38,109,36],[100,44,109,42],[100,47,109,54],[100,58,109,74],[101,8,110,6,"content"],[101,15,110,13],[101,17,110,15,"msg"],[101,20,110,18],[101,21,110,19,"text"],[102,6,111,4],[102,7,111,5],[102,8,111,6],[102,9,111,7],[104,6,113,4],[105,6,114,4,"recentChat"],[105,16,114,14],[105,17,114,15,"push"],[105,21,114,19],[105,22,114,20],[106,8,114,22,"role"],[106,12,114,26],[106,14,114,28],[106,20,114,34],[107,8,114,36,"content"],[107,15,114,43],[107,17,114,45,"userMessage"],[108,6,114,57],[108,7,114,58],[108,8,114,59],[109,6,116,4],[109,12,116,10,"request"],[109,19,116,35],[109,22,116,38],[110,8,117,6,"mode"],[110,12,117,10],[110,14,117,12],[110,20,117,18],[111,8,118,6,"language"],[111,16,118,14],[111,18,118,16,"state"],[111,23,118,21],[111,24,118,22,"language"],[111,32,118,30],[111,36,118,34],[111,40,118,38],[112,8,119,6,"model"],[112,13,119,11],[112,15,119,13],[112,28,119,26],[113,8,120,6,"summary"],[113,15,120,13],[114,8,121,6,"messages"],[114,16,121,14],[114,18,121,16,"recentChat"],[115,6,122,4],[115,7,122,5],[116,6,124,4],[116,12,124,10,"result"],[116,18,124,16],[116,21,124,19],[116,27,124,25,"callCloudLLM"],[116,39,124,37],[116,40,124,38,"request"],[116,47,124,45],[116,48,124,46],[117,6,125,4],[117,10,125,8,"result"],[117,16,125,14],[117,20,125,18,"result"],[117,26,125,24],[117,27,125,25,"trim"],[117,31,125,29],[117,32,125,30],[117,33,125,31],[117,35,125,33],[118,8,126,6,"console"],[118,15,126,13],[118,16,126,14,"log"],[118,19,126,17],[118,20,126,18],[118,50,126,48],[118,51,126,49],[119,8,127,6],[119,15,127,13,"result"],[119,21,127,19],[119,22,127,20,"trim"],[119,26,127,24],[119,27,127,25],[119,28,127,26],[120,6,128,4],[121,6,130,4],[121,12,130,10],[121,16,130,14,"Error"],[121,21,130,19],[121,22,130,20],[121,53,130,51],[121,54,130,52],[122,4,131,2],[122,5,131,3],[122,6,131,4],[122,13,131,11,"error"],[122,18,131,16],[122,20,131,18],[123,6,132,4,"console"],[123,13,132,11],[123,14,132,12,"log"],[123,17,132,15],[123,18,132,16],[123,69,132,67],[123,71,132,69,"error"],[123,76,132,74],[123,77,132,75],[124,6,133,4],[124,13,133,11],[124,19,133,17],[124,23,133,17,"localReply"],[124,44,133,27],[124,46,133,28,"state"],[124,51,133,33],[124,53,133,35,"userMessage"],[124,64,133,46],[124,65,133,47],[125,4,134,2],[126,2,135,0],[128,2,137,0],[129,0,138,0],[130,0,139,0],[131,2,140,7],[131,17,140,22,"getAIStatus"],[131,28,140,33,"getAIStatus"],[131,29,140,33],[131,31,140,76],[132,4,141,2],[132,8,141,6],[133,6,142,4],[133,12,142,10,"isConnected"],[133,23,142,21],[133,26,142,24],[133,32,142,30,"testCloudConnection"],[133,51,142,49],[133,52,142,50],[133,53,142,51],[134,6,143,4],[134,13,143,11,"isConnected"],[134,24,143,22],[134,27,143,25],[134,34,143,32],[134,37,143,35],[134,44,143,42],[135,4,144,2],[135,5,144,3],[135,6,144,4],[135,13,144,11,"error"],[135,18,144,16],[135,20,144,18],[136,6,145,4],[136,13,145,11],[136,20,145,18],[137,4,146,2],[138,2,147,0],[139,0,147,1],[139,3]],"functionMap":{"names":["<global>","testCloudConnection","callCloudLLM","hybridGreeting","hybridReply","slice.map$argument_0","getAIStatus"],"mappings":"AAA;OCmB;CDW;OEK;CFqB;OGK;CH6B;OIK;wDCY;MDG;CJwB;OMK"}},"type":"js/module"}]}