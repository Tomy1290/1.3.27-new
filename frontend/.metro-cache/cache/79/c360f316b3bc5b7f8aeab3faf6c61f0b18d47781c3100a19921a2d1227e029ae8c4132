{"dependencies":[{"name":"../gamification/events","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":55},"end":{"line":2,"column":99,"index":154}}],"key":"kS+dQODfMADUn5Es/Mb8ksF0WwM=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.buildCompactSummary = buildCompactSummary;\n  var _events = require(_dependencyMap[0]);\n  function avg(xs) {\n    return xs.length ? xs.reduce((a, b) => a + b, 0) / xs.length : 0;\n  }\n  function buildCompactSummary(state) {\n    var days = Object.values(state.days || {}).sort((a, b) => a.date.localeCompare(b.date));\n    var last14 = days.slice(-14);\n    var last7 = days.slice(-7);\n    var waterAvg = avg(last14.map(d => d.drinks?.water ?? 0));\n    var coffeeAvg = avg(last14.map(d => d.drinks?.coffee ?? 0));\n    var pillAdh = last7.length ? last7.filter(d => d.pills?.morning && d.pills?.evening).length / last7.length : 0;\n    var weights = days.filter(d => typeof d.weight === 'number');\n    var weightTrend = 0;\n    var weightLast = undefined;\n    if (weights.length >= 3) {\n      var first = weights[0].weight;\n      var last = weights[weights.length - 1].weight;\n      weightLast = last;\n      weightTrend = (last - first) / Math.max(1, weights.length - 1);\n    }\n    // weekly event progress (current week)\n    var week = (0, _events.getWeekRange)(new Date());\n    var evt = (0, _events.getCurrentWeeklyEvent)(week.start);\n    var _computeEventProgress = (0, _events.computeEventProgress)(week.dayKeys, state, evt),\n      percent = _computeEventProgress.percent;\n    return {\n      lang: state.language,\n      water_avg14: Number(waterAvg.toFixed(2)),\n      coffee_avg14: Number(coffeeAvg.toFixed(2)),\n      pill_adherence7: Number((pillAdh * 100).toFixed(0)),\n      weight_last: typeof weightLast === 'number' ? Number(weightLast.toFixed(1)) : null,\n      weight_trend_per_day: Number(weightTrend.toFixed(3)),\n      weekly_event: {\n        id: evt.id,\n        title: evt.title(state.language),\n        progress: percent\n      }\n    };\n  }\n});","lineCount":45,"map":[[6,2,2,0],[6,6,2,0,"_events"],[6,13,2,0],[6,16,2,0,"require"],[6,23,2,0],[6,24,2,0,"_dependencyMap"],[6,38,2,0],[7,2,4,0],[7,11,4,9,"avg"],[7,14,4,12,"avg"],[7,15,4,13,"xs"],[7,17,4,25],[7,19,4,27],[8,4,4,29],[8,11,4,36,"xs"],[8,13,4,38],[8,14,4,39,"length"],[8,20,4,45],[8,23,4,48,"xs"],[8,25,4,50],[8,26,4,51,"reduce"],[8,32,4,57],[8,33,4,58],[8,34,4,59,"a"],[8,35,4,60],[8,37,4,61,"b"],[8,38,4,62],[8,43,4,65,"a"],[8,44,4,66],[8,47,4,67,"b"],[8,48,4,68],[8,50,4,69],[8,51,4,70],[8,52,4,71],[8,55,4,72,"xs"],[8,57,4,74],[8,58,4,75,"length"],[8,64,4,81],[8,67,4,84],[8,68,4,85],[9,2,4,87],[10,2,6,7],[10,11,6,16,"buildCompactSummary"],[10,30,6,35,"buildCompactSummary"],[10,31,6,36,"state"],[10,36,6,84],[10,38,6,86],[11,4,7,2],[11,8,7,8,"days"],[11,12,7,12],[11,15,7,15,"Object"],[11,21,7,21],[11,22,7,22,"values"],[11,28,7,28],[11,29,7,29,"state"],[11,34,7,34],[11,35,7,35,"days"],[11,39,7,39],[11,43,7,41],[11,44,7,42],[11,45,7,43],[11,46,7,44],[11,47,7,45,"sort"],[11,51,7,49],[11,52,7,50],[11,53,7,51,"a"],[11,54,7,60],[11,56,7,61,"b"],[11,57,7,70],[11,62,7,73,"a"],[11,63,7,74],[11,64,7,75,"date"],[11,68,7,79],[11,69,7,80,"localeCompare"],[11,82,7,93],[11,83,7,94,"b"],[11,84,7,95],[11,85,7,96,"date"],[11,89,7,100],[11,90,7,101],[11,91,7,102],[12,4,8,2],[12,8,8,8,"last14"],[12,14,8,14],[12,17,8,17,"days"],[12,21,8,21],[12,22,8,22,"slice"],[12,27,8,27],[12,31,8,31],[12,32,8,32],[13,4,9,2],[13,8,9,8,"last7"],[13,13,9,13],[13,16,9,16,"days"],[13,20,9,20],[13,21,9,21,"slice"],[13,26,9,26],[13,29,9,29],[13,30,9,30],[14,4,10,2],[14,8,10,8,"waterAvg"],[14,16,10,16],[14,19,10,19,"avg"],[14,22,10,22],[14,23,10,23,"last14"],[14,29,10,29],[14,30,10,30,"map"],[14,33,10,33],[14,34,10,34,"d"],[14,35,10,35],[14,39,10,37,"d"],[14,40,10,38],[14,41,10,39,"drinks"],[14,47,10,45],[14,49,10,47,"water"],[14,54,10,52],[14,58,10,54],[14,59,10,55],[14,60,10,56],[14,61,10,57],[15,4,11,2],[15,8,11,8,"coffeeAvg"],[15,17,11,17],[15,20,11,20,"avg"],[15,23,11,23],[15,24,11,24,"last14"],[15,30,11,30],[15,31,11,31,"map"],[15,34,11,34],[15,35,11,35,"d"],[15,36,11,36],[15,40,11,38,"d"],[15,41,11,39],[15,42,11,40,"drinks"],[15,48,11,46],[15,50,11,48,"coffee"],[15,56,11,54],[15,60,11,56],[15,61,11,57],[15,62,11,58],[15,63,11,59],[16,4,12,2],[16,8,12,8,"pillAdh"],[16,15,12,15],[16,18,12,18,"last7"],[16,23,12,23],[16,24,12,24,"length"],[16,30,12,30],[16,33,12,34,"last7"],[16,38,12,39],[16,39,12,40,"filter"],[16,45,12,46],[16,46,12,47,"d"],[16,47,12,48],[16,51,12,50,"d"],[16,52,12,51],[16,53,12,52,"pills"],[16,58,12,57],[16,60,12,59,"morning"],[16,67,12,66],[16,71,12,70,"d"],[16,72,12,71],[16,73,12,72,"pills"],[16,78,12,77],[16,80,12,79,"evening"],[16,87,12,86],[16,88,12,87],[16,89,12,88,"length"],[16,95,12,94],[16,98,12,95,"last7"],[16,103,12,100],[16,104,12,101,"length"],[16,110,12,107],[16,113,12,111],[16,114,12,112],[17,4,13,2],[17,8,13,8,"weights"],[17,15,13,15],[17,18,13,18,"days"],[17,22,13,22],[17,23,13,23,"filter"],[17,29,13,29],[17,30,13,30,"d"],[17,31,13,31],[17,35,13,33],[17,42,13,40,"d"],[17,43,13,41],[17,44,13,42,"weight"],[17,50,13,48],[17,55,13,51],[17,63,13,59],[17,64,13,60],[18,4,14,2],[18,8,14,6,"weightTrend"],[18,19,14,17],[18,22,14,20],[18,23,14,21],[19,4,14,23],[19,8,14,27,"weightLast"],[19,18,14,57],[19,21,14,60,"undefined"],[19,30,14,69],[20,4,15,2],[20,8,15,6,"weights"],[20,15,15,13],[20,16,15,14,"length"],[20,22,15,20],[20,26,15,22],[20,27,15,23],[20,29,15,25],[21,6,16,4],[21,10,16,10,"first"],[21,15,16,15],[21,18,16,18,"weights"],[21,25,16,25],[21,26,16,26],[21,27,16,27],[21,28,16,28],[21,29,16,29,"weight"],[21,35,16,36],[22,6,16,38],[22,10,16,44,"last"],[22,14,16,48],[22,17,16,51,"weights"],[22,24,16,58],[22,25,16,59,"weights"],[22,32,16,66],[22,33,16,67,"length"],[22,39,16,73],[22,42,16,74],[22,43,16,75],[22,44,16,76],[22,45,16,77,"weight"],[22,51,16,84],[23,6,16,86,"weightLast"],[23,16,16,96],[23,19,16,99,"last"],[23,23,16,103],[24,6,17,4,"weightTrend"],[24,17,17,15],[24,20,17,18],[24,21,17,19,"last"],[24,25,17,23],[24,28,17,24,"first"],[24,33,17,29],[24,37,17,31,"Math"],[24,41,17,35],[24,42,17,36,"max"],[24,45,17,39],[24,46,17,40],[24,47,17,41],[24,49,17,43,"weights"],[24,56,17,50],[24,57,17,51,"length"],[24,63,17,57],[24,66,17,58],[24,67,17,59],[24,68,17,60],[25,4,18,2],[26,4,19,2],[27,4,20,2],[27,8,20,8,"week"],[27,12,20,12],[27,15,20,15],[27,19,20,15,"getWeekRange"],[27,39,20,27],[27,41,20,28],[27,45,20,32,"Date"],[27,49,20,36],[27,50,20,37],[27,51,20,38],[27,52,20,39],[28,4,21,2],[28,8,21,8,"evt"],[28,11,21,11],[28,14,21,14],[28,18,21,14,"getCurrentWeeklyEvent"],[28,47,21,35],[28,49,21,36,"week"],[28,53,21,40],[28,54,21,41,"start"],[28,59,21,46],[28,60,21,47],[29,4,22,2],[29,8,22,2,"_computeEventProgress"],[29,29,22,2],[29,32,22,22],[29,36,22,22,"computeEventProgress"],[29,64,22,42],[29,66,22,43,"week"],[29,70,22,47],[29,71,22,48,"dayKeys"],[29,78,22,55],[29,80,22,57,"state"],[29,85,22,62],[29,87,22,71,"evt"],[29,90,22,74],[29,91,22,75],[30,6,22,10,"percent"],[30,13,22,17],[30,16,22,17,"_computeEventProgress"],[30,37,22,17],[30,38,22,10,"percent"],[30,45,22,17],[31,4,24,2],[31,11,24,9],[32,6,25,4,"lang"],[32,10,25,8],[32,12,25,10,"state"],[32,17,25,15],[32,18,25,16,"language"],[32,26,25,24],[33,6,26,4,"water_avg14"],[33,17,26,15],[33,19,26,17,"Number"],[33,25,26,23],[33,26,26,24,"waterAvg"],[33,34,26,32],[33,35,26,33,"toFixed"],[33,42,26,40],[33,43,26,41],[33,44,26,42],[33,45,26,43],[33,46,26,44],[34,6,27,4,"coffee_avg14"],[34,18,27,16],[34,20,27,18,"Number"],[34,26,27,24],[34,27,27,25,"coffeeAvg"],[34,36,27,34],[34,37,27,35,"toFixed"],[34,44,27,42],[34,45,27,43],[34,46,27,44],[34,47,27,45],[34,48,27,46],[35,6,28,4,"pill_adherence7"],[35,21,28,19],[35,23,28,21,"Number"],[35,29,28,27],[35,30,28,28],[35,31,28,29,"pillAdh"],[35,38,28,36],[35,41,28,37],[35,44,28,40],[35,46,28,42,"toFixed"],[35,53,28,49],[35,54,28,50],[35,55,28,51],[35,56,28,52],[35,57,28,53],[36,6,29,4,"weight_last"],[36,17,29,15],[36,19,29,17],[36,26,29,24,"weightLast"],[36,36,29,34],[36,41,29,37],[36,49,29,45],[36,52,29,47,"Number"],[36,58,29,53],[36,59,29,54,"weightLast"],[36,69,29,64],[36,70,29,65,"toFixed"],[36,77,29,72],[36,78,29,73],[36,79,29,74],[36,80,29,75],[36,81,29,76],[36,84,29,79],[36,88,29,83],[37,6,30,4,"weight_trend_per_day"],[37,26,30,24],[37,28,30,26,"Number"],[37,34,30,32],[37,35,30,33,"weightTrend"],[37,46,30,44],[37,47,30,45,"toFixed"],[37,54,30,52],[37,55,30,53],[37,56,30,54],[37,57,30,55],[37,58,30,56],[38,6,31,4,"weekly_event"],[38,18,31,16],[38,20,31,18],[39,8,31,20,"id"],[39,10,31,22],[39,12,31,24,"evt"],[39,15,31,27],[39,16,31,28,"id"],[39,18,31,30],[40,8,31,32,"title"],[40,13,31,37],[40,15,31,39,"evt"],[40,18,31,42],[40,19,31,43,"title"],[40,24,31,48],[40,25,31,49,"state"],[40,30,31,54],[40,31,31,55,"language"],[40,39,31,70],[40,40,31,71],[41,8,31,73,"progress"],[41,16,31,81],[41,18,31,83,"percent"],[42,6,31,91],[43,4,32,2],[43,5,32,3],[44,2,33,0],[45,0,33,1],[45,3]],"functionMap":{"names":["<global>","avg","xs.reduce$argument_0","buildCompactSummary","Object.values.sort$argument_0","last14.map$argument_0","last7.filter$argument_0","days.filter$argument_0"],"mappings":"AAA;ACG,0DC,UD,oBD;OGE;kDCC,mDD;kCEG,qBF;mCEC,sBF;+CGC,uCH;8BIC,6BJ"}},"type":"js/module"}]}